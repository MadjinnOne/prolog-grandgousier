## Phase 0 â€“ Mise au propre du squelette

ğŸ¯ Objectif : avoir une base stable avant dâ€™ajouter de lâ€™intelligence.

1. VÃ©rifier que :

   * le squelette `grandgousier` se compile sans erreur ;
   * le module `base_vins` est bien chargÃ© ;
   * la boucle principale affiche la phrase dâ€™accueil de lâ€™Ã©noncÃ©, lit une question, affiche la rÃ©ponse par dÃ©faut, et sâ€™arrÃªte sur Â« fin Â».

2. Test manuel :

   * Lancer `grandgousier` depuis Prolog.
   * Poser une question quelconque â†’ rÃ©ponse par dÃ©faut Â« je ne sais pasâ€¦ Â».
   * Taper Â« fin Â» â†’ message dâ€™au revoir et arrÃªt du programme.

---

## Phase 1 â€“ Base de connaissances sur les vins

ğŸ¯ Objectif : garantir que tous les vins nÃ©cessaires aux dialogues sont correctement dÃ©crits.

1. **Lister les vins impliquÃ©s dans les dialogues** Ã  partir de lâ€™Ã©noncÃ© :

   * CÃ´tÃ© Bourgogne : Coteaux Bourguignons 2014, Bourgogne Pinot Noir (les Marnes), Hautes CÃ´tes de Nuits 2014, Nuits-Saint-Georges 1er cru 2013 Â« Les Chaboeufs Â», Chambolle-Musigny 1er cru 2012 Les Noirotsâ€¦
   * CÃ´tÃ© prix 20â€“35â‚¬ : La Fleur de Pomys 2012, Hermitage rouge 2007â€¦
   * CÃ´tÃ© canard : Graves, St-Ã‰milion, Pomerol, Marsannay, Fixin, Nuits St Georges, Gevrey-Chambertin, CÃ´te RÃ´tie, St Joseph, Hermitageâ€¦
   * CÃ´tÃ© appellation : Haut-MÃ©doc.

2. Pour chaque vin concernÃ©, vÃ©rifier/complÃ©ter dans la base :

   * un identifiant interne (par ex. `la_fleur_de_pomys_2012`) associÃ© Ã  son nom lisible ;
   * un prix cohÃ©rent avec lâ€™Ã©noncÃ© (7,99 ; 11,92 ; 15,16 ; 42,35 ; 63,85 ; 21,36 ; 33,98 ; 9,46, etc.) ;
   * un texte Â« au nez Â» et Â« en bouche Â» pour les vins mentionnÃ©s dans les questions nez/bouche ;
   * un texte de description pour La Fleur de Pomys (texte long extrait de GrafÃ©-Lecocq / projet).

3. PrÃ©parer (au moins pour les besoins du projet) une mini-taxonomie :

   * provenance (Bordeaux, Bourgogne, RhÃ´ne Nord, etc.) ;
   * appellation (Haut-MÃ©doc, Graves, Saint-Ã‰milion, etc.), mÃªme si tu ne lâ€™utilises pas immÃ©diatement.

4. Tests internes (Prolog interactif) :

   * Interroger la base pour chaque vin : nom, prix, nez, bouche, description.
   * VÃ©rifier que les textes sont des listes de listes de mots, prÃªts Ã  Ãªtre affichÃ©s.

---

## Phase 2 â€“ Normalisation des noms de vins dans les questions

ğŸ¯ Objectif : faire le pont entre ce que tape lâ€™utilisateur (Â« nuits saint georges Â») et tes identifiants internes (`les_chaboeufs_2013`, etc.).

1. Identifier les formes textuelles que lâ€™utilisateur va taper :

   * Nuits-Saint-Georges / nuits saint georges / avec ou sans annÃ©e ;
   * Chambolle-Musigny / chambolle musigny / avec ou sans annÃ©e ;
   * La Fleur de Pomys / la fleur de pomys / avec ou sans annÃ©e ;
   * Ã©ventuellement Beaumes-de-Venise (dÃ©jÃ  commencÃ©) et autres vins si utile.

2. Concevoir une **normalisation des noms** :

   * dÃ©finir quelles sÃ©quences de mots doivent Ãªtre reconnues pour chaque vin ;
   * prÃ©voir les variantes minimales utiles (avec ou sans millÃ©sime).

3. Adapter le prÃ©dicat de normalisation (celui qui transforme la liste de mots de la question en liste â€œuniformisÃ©eâ€) pour :

   * remplacer les sÃ©quences `[nuits, saint, georges, â€¦]` par lâ€™identifiant du Nuits-Saint-Georges ;
   * remplacer `[chambolle, musigny, â€¦]` par lâ€™identifiant du Chambolle ;
   * remplacer `[la, fleur, de, pomys, â€¦]` par lâ€™identifiant de La Fleur de Pomys ;
   * conserver les autres mots inchangÃ©s.

4. Tests Â« moteur de normalisation Â» :

   * Simuler des listes de mots (issues de `read_atomics`) et vÃ©rifier que la normalisation renvoie bien la liste avec lâ€™identifiant du vin au bon endroit.
   * VÃ©rifier plusieurs variantes (avec et sans annÃ©e, ordre des mots, etc.).

---

## Phase 3 â€“ Questions directes sur un vin (nez, bouche, description)

ğŸ¯ Objectif : faire fonctionner les trois questions Â« simples Â» recommandÃ©es dans lâ€™Ã©noncÃ© :

* Que donne le Nuits-Saint-Georges en bouche ?
* Quel nez prÃ©sente le Chambolle-Musigny ?
* Pourriez-vous mâ€™en dire plus sur La Fleur de Pomys ?

1. Choisir une stratÃ©gie de reconnaissance :

   * identifier les mots-clÃ©s : â€œboucheâ€, â€œnezâ€, â€œpourriezvousâ€ (ou Ã©quivalent) ;
   * associer Ã  chaque mot-clÃ© un niveau dâ€™importance (mclef) ;
   * dÃ©finir pour chaque mot-clÃ© un ou plusieurs patterns (listes de mots) correspondant aux formulations autorisÃ©es des questions.

2. Pour chaque type de question :

   * dÃ©finir un pattern sur la liste de mots (incluant un Â« trou Â» pour le vin) ;
   * dÃ©finir la maniÃ¨re dâ€™extraire lâ€™identifiant du vin (grÃ¢ce Ã  la normalisation faite Ã  la phase 2) ;
   * dÃ©finir la construction de la rÃ©ponse Ã  partir des prÃ©dicats `nez`, `bouche`, `description` (rÃ©utiliser leur texte tel quel, sans le reformatter manuellement).

3. Tests Â« dialogue Â» :

   * Lancer `grandgousier` et poser :

     * Â« que donne le nuits saint georges en bouche ? Â»
     * Â« quel nez presente le chambolle musigny ? Â»
     * Â« pourriezvous men dire plus sur la fleur de pomys ? Â»
   * VÃ©rifier que les textes retournÃ©s correspondent bien Ã  la base (impression en bouche, nez, description dÃ©taillÃ©e).

---

## Phase 4 â€“ RequÃªtes par prix (entre 20 et 35 EUR)

ğŸ¯ Objectif : rÃ©pondre Ã  Â« Auriez-vous des vins entre 20 et 35 EUR ? Â» en proposant la bonne sÃ©lection (La Fleur de Pomys 2012, Hermitage rouge 2007, etc.).

1. DÃ©finir le rÃ´le du mot-clÃ© â€œvinsâ€ ou dâ€™un autre mot-clÃ© spÃ©cifique aux requÃªtes de prix.

2. Concevoir la logique :

   * extraire les deux bornes numÃ©riques X et Y de la question ;
   * parcourir la base de vins pour trouver tous ceux dont le prix P satisfait X â‰¤ P â‰¤ Y ;
   * ordonner Ã©ventuellement la liste (par prix croissant, par exemple).

3. DÃ©finir un format de rÃ©ponse textuelle :

   * phrase dâ€™introduction (Â« Oui, je vous conseilleâ€¦ Â») ;
   * une ligne par vin, avec son nom, Ã©ventuellement un court commentaire (Â« un vin dense et racÃ© Â»), et le prix (en EUR) ;

4. Tests :

   * poser exactement la question de lâ€™Ã©noncÃ© ;
   * vÃ©rifier que la liste contient au moins La Fleur de Pomys 2012 et Hermitage rouge 2007, avec les bons prix et Ã©ventuels commentaires.

---

## Phase 5 â€“ Conseils par rÃ©gion : Bourgogne (vins principaux + autres)

ğŸ¯ Objectif : reproduire les deux premiÃ¨res rÃ©pliques de lâ€™Ã©noncÃ© sur la Bourgogne :

* Â« Quels vins de Bourgogne me conseillez-vous ? Â»
* Â« Auriez-vous dâ€™autres vins de Bourgogne ? Â»

1. Construire une mini-base de recommandations pour la **Bourgogne** :

   * liste de Â« premiers conseils Â» (Coteaux Bourguignons 2014, Bourgogne Pinot Noir les Marnes, Hautes CÃ´tes de Nuits 2014) avec, pour chaque, un petit commentaire (plaisant, polyvalent, grande personnalitÃ©â€¦) et le prix ;
   * liste de Â« vins supplÃ©mentaires Â» (Nuits-Saint-Georges Chaboeufs, Chambolle-Musigny Noirots) avec leur commentaire et prix.

2. DÃ©finir les mots-clÃ©s :

   * un mot-clÃ© liÃ© Ã  la rÃ©gion â€œbourgogneâ€ ;
   * Ã©ventuellement un mot-clÃ© distinct pour la question Â« dâ€™autres vins Â».

3. Concevoir les patterns :

   * pattern pour Â« Quels vins de Bourgogne me conseillez-vous ? Â» (premier conseil) ;
   * pattern pour Â« Auriez-vous dâ€™autres vins de Bourgogne ? Â» (liste supplÃ©mentaire).

4. PrÃ©voir des prÃ©dicats auxiliaires pour :

   * transformer les listes de vins recommandÃ©s en listes de phrases structurÃ©es (nom + commentaire + prix) ;
   * factoriser si possible, pour rÃ©utiliser la mÃªme logique avec dâ€™autres rÃ©gions plus tard (optionnel mais propre).

5. Tests :

   * poser les deux questions consÃ©cutivement et vÃ©rifier que la deuxiÃ¨me rÃ©ponse **ne rÃ©pÃ¨te pas** ceux du premier conseil, mais donne bien les vins supplÃ©mentaires attendus.

---

## Phase 6 â€“ Association vin / plat : le canard

ğŸ¯ Objectif : gÃ©rer la question :
Â« Pour NoÃ«l, jâ€™envisage de cuisiner du canard. Quel vin me conseillez-vous ? Â»

1. DÃ©finir une structure de connaissances pour lâ€™accord mets/vins :

   * associer le plat â€œcanardâ€ Ã  une description globale du style de vin (rouge puissant, Ã©picÃ©, fumÃ©, fin de bouche tannique, etc.) ;
   * associer le plat â€œcanardâ€ Ã  une liste dâ€™appellations recommandÃ©es, rÃ©parties par rÃ©gion (Bordeaux, Bourgogne, RhÃ´ne Nord) comme dans lâ€™Ã©noncÃ©.

2. DÃ©finir un mot-clÃ© liÃ© au plat (par exemple â€œcanardâ€) et/ou un mot-clÃ© plus gÃ©nÃ©ral (mets, plat).

3. Concevoir le pattern :

   * formulation ciblant la phrase de lâ€™Ã©noncÃ© (Ã©ventuellement avec quelques variantes possibles : â€œje cuisine du canardâ€, â€œje vais prÃ©parer du canardâ€â€¦).

4. DÃ©finir la rÃ©ponse attendue :

   * phrase gÃ©nÃ©rale dÃ©crivant le style de vin ;
   * ensuite la liste dâ€™appellations regroupÃ©es par rÃ©gion, exactement dans lâ€™esprit de lâ€™Ã©noncÃ© (Bordeaux : â€¦, Bourgogne : â€¦, RhÃ´ne Nord : â€¦).

5. Tests :

   * poser la question de lâ€™Ã©noncÃ© ;
   * vÃ©rifier que la rÃ©ponse contient la description gÃ©nÃ©rale + les appellations dans les bons groupes.

---

## Phase 7 â€“ Choix dâ€™un vin prÃ©cis Ã  partir dâ€™une appellation (ex. Graves)

ğŸ¯ Objectif : gÃ©rer Â« Vous auriez un Graves ? Â» et proposer le Ch. Menota CuvÃ©e Montagrede 2014 avec son prix.

1. Introduire une classification appellation â†’ vins :

   * associer lâ€™appellation Graves Ã  un ou plusieurs vins de la base (au minimum Ch. Menota 2014).

2. DÃ©finir un mot-clÃ© pour cette appellation (ou rÃ©utiliser la structure appellation construite plus tÃ´t).

3. Concevoir la logique :

   * lorsquâ€™on dÃ©tecte â€œGravesâ€ dans la question, rechercher un vin correspondant Ã  cette appellation dans la base ;
   * choisir un vin Â« recommandÃ© Â» (dans ce cas prÃ©cis, Ch. Menota 2014).

4. Formater la rÃ©ponse :

   * phrase courte : Â« Oui, je vous conseille â€¦ Â» ;
   * nom du vin, millÃ©sime, prix, texte entre parenthÃ¨ses comme dans lâ€™Ã©noncÃ©.

5. Tests :

   * poser Â« vous auriez un graves ? Â» ;
   * vÃ©rifier que la rÃ©ponse mentionne bien le vin et son prix exact.

---

## Phase 8 â€“ Explication dâ€™une appellation (Haut-MÃ©doc)

ğŸ¯ Objectif : gÃ©rer la question explicative :
Â« Que recouvre lâ€™appellation Haut-MÃ©doc ? Â»

1. CrÃ©er une mini-base descriptive des appellations importantes :

   * au minimum une entrÃ©e pour `haut_medoc` contenant le texte explicatif de lâ€™Ã©noncÃ© (vignoble du MÃ©doc, moitiÃ© sud, appellation rÃ©gionale, communes enclavÃ©es, etc.).

2. DÃ©finir les mots-clÃ©s :

   * â€œappellationâ€ ;
   * Ã©ventuellement chaque nom dâ€™appellation (hauts-medoc, gravesâ€¦) si nÃ©cessaire.

3. Concevoir le pattern pour la question :

   * quelque chose du type Â« que recouvre lâ€™appellation X ? Â».

4. DÃ©finir la logique :

   * extraire le nom de lâ€™appellation dans la question ;
   * le normaliser vers lâ€™identifiant interne (`haut_medoc`) ;
   * sÃ©lectionner la description correspondante dans la base et la retourner.

5. Tests :

   * poser Â« que recouvre lappellation haut medoc ? Â» ;
   * vÃ©rifier que la rÃ©ponse reprend bien lâ€™explication complÃ¨te (aire, subdivision, communes, etc.).

---

## Phase 9 â€“ Moteur de rÃ¨gles / mots-clÃ©s plus robuste

ğŸ¯ Objectif : amÃ©liorer la stratÃ©gie gÃ©nÃ©rale pour quâ€™elle colle Ã  ce que demande lâ€™Ã©noncÃ© : sÃ©lection du meilleur mot-clÃ© selon son importance, puis test des patterns associÃ©s.

1. Mettre en place la construction dâ€™une **liste de mots-clÃ©s dÃ©tectÃ©s** dans la question :

   * parcourir les mots de la question ;
   * pour chaque mot qui est un mot-clÃ© connu, rÃ©cupÃ©rer son importance.

2. Ordonner cette liste par importance dÃ©croissante.

3. Pour chaque mot-clÃ© (dans cet ordre) :

   * tester, un par un, les patterns associÃ©s Ã  ce mot-clÃ© ;
   * vÃ©rifier les Ã©ventuelles conditions supplÃ©mentaires (prix, rÃ©gion, etc.) ;
   * dÃ¨s quâ€™un pattern et ses conditions rÃ©ussissent, retourner la rÃ©ponse correspondante.

4. GÃ©rer le cas Â« je ne sais pas Â» :

   * si aucun mot-clÃ© pertinent nâ€™est trouvÃ© ou si aucun pattern ne matche, tomber sur la rÃ©ponse par dÃ©faut.

5. Tests globaux :

   * rejouer tous les dialogues de lâ€™Ã©noncÃ© dâ€™une traite et vÃ©rifier que le bon mot-clÃ© est utilisÃ© Ã  chaque fois, sans interfÃ©rence (ex. la question sur les prix ne doit pas Ãªtre prise pour une question sur la rÃ©gion).

---

## Phase 10 â€“ Variantes de formulations & robustesse

ğŸ¯ Objectif : rendre le bot moins fragile sans exploser la complexitÃ©.

1. Pour chaque type de question dÃ©jÃ  gÃ©rÃ© :

   * imaginer 2 ou 3 formulations naturelles proches (par ex. inversion du sujet, ajout de â€œsâ€™il vous plaÃ®tâ€, etc.) ;
   * dÃ©cider lesquelles tu veux supporter rÃ©ellement (en restant raisonnable).

2. Pour ces nouvelles formulations :

   * ajouter des patterns supplÃ©mentaires pour les mÃªmes mots-clÃ©s ;
   * privilÃ©gier des patterns sobres, centrÃ©s sur les mots porteurs de sens (bourgogne, vins, bouche, nez, canard, etc.).

3. Tests :

   * poser ces variantes et vÃ©rifier que le mÃªme traitement est appliquÃ©.

---

## Phase 11 â€“ Rapport Ã©crit

ğŸ¯ Objectif : produire un rapport qui montre que tu maÃ®trises le projet et tes choix techniques.

Plan possible :

1. **Introduction**

   * objectif du projet ;
   * rÃ´le de Grandgousier (conseil en vins, informations, etc.).

2. **Architecture gÃ©nÃ©rale**

   * transformation des questions en listes de mots (lecture, nettoyage) ;
   * transformation inverse pour les rÃ©ponses (Ã©criture formatÃ©e) ;
   * boucle principale de dialogue.

3. **ReprÃ©sentation des connaissances**

   * structure des faits sur les vins : identifiants, noms, prix, nez, bouche, description ;
   * classification par rÃ©gion, appellation, type de plat.

4. **StratÃ©gie de traitement des questions**

   * notion de mot-clÃ© et dâ€™importance ;
   * structure des rÃ¨gles (mot-clÃ©, numÃ©ro de pattern, pattern, rÃ©ponse, conditions) ;
   * stratÃ©gie de sÃ©lection dâ€™une rÃ¨gle (tri des mots-clÃ©s, test successif des patterns).

5. **DÃ©tails de rÃ©alisation des dialogues demandÃ©s**

   * conseils pour les vins de Bourgogne (premiers et autres) ;
   * sÃ©lection de vins par prix ;
   * questions directes nez/bouche/description ;
   * associations vin/plat (canard) ;
   * explication dâ€™appellation (Haut-MÃ©doc).

6. **Exemples de dialogues commentÃ©s**

   * reproduire le dialogue complet de lâ€™Ã©noncÃ© ;
   * expliquer, pour quelques questions, quelle rÃ¨gle et quelles connaissances ont Ã©tÃ© utilisÃ©es.

7. **Conclusion**

   * limites du prototype ;
   * pistes dâ€™amÃ©lioration (autres mets, autres rÃ©gions, analyse grammaticale plus fine, etc.).

---

Si tu veux, on peut maintenant prendre **une phase prÃ©cise** (par exemple Phase 3 ou 5) et je te dÃ©taille quelles questions poser exactement Ã  Codex pour quâ€™il implÃ©mente ce bloc de fonctionnalitÃ©s en une fois.
